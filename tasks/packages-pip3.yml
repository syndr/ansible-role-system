---

- name: Deprecation warning for pip3 packages
  ansible.builtin.debug:
    msg: |
      [DEPRECATION WARNING]: system_enable_pip_packages and global pip installation is deprecated
      and will be removed in a future version. Modern Python environments (Ubuntu 22.04+) block
      global pip installs per PEP 668. Please migrate to system_enable_venv instead.
      Migration: Set system_enable_venv=true and move packages to system_venv_packages_base/extra.
      This feature will be removed in version 3.0.0.

- name: OS support warning
  when: ansible_distribution | lower == 'ubuntu'
  ansible.builtin.debug:
    msg: "WARNING: global pip3 packages are not supported on Ubuntu!"

- name: Install Packages with pip3
  become: true
  ansible.builtin.pip:
    name: "{{ item.key }}"
    version: "{{ item.value.version | default(omit) }}"
    state: present
    executable: pip3
  loop: "{{ (system_packages_pip3_base | default({}) | combine(system_packages_pip3_extra | default({})) | dict2items) }}"
  when:
    - (system_packages_pip3_base | default({}) | length > 0) or (system_packages_pip3_extra | default({}) | length > 0)
    - ansible_distribution | lower != 'ubuntu'

